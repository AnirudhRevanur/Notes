# Malware

- Program that is covertly inserted into another program with intent to destroy data
- Compromise CIA, or OS
- Most common external threat to most hosts
- Classified based on:
  - How it spreads
  - Actions or payloads it performs

## Propagation

- Infection of existing content and is spread to other systems
- Exploits by worms or drive by downloads
- Social Engineering Attacks

## Payload

- Corruption of system data
- Theft of service
- Make it a zombie in a botet
- Keylogging
- Hiding its presence on the system

## Symptoms

- Your contacts get strange messages from you
- Slow computer
- Battery drains quickly
- System crashes
- Loss in disk space
- Increase in internet activity
- AV is shutdown

## Attack Sources

- Politically Motivated
- Criminals
- Organized Crime
- Organizations that sell their services
- National Government Agencies

## Advanced Persistent Threats

- Well resourced and persistent application of a wide variety of intrusion technologies
- Attributed to state sponsored organizations
- Differ from other types of attack by careful target selections
- Stuxnet

## Viruses

- Pieces of software that infects programs
  - Modifies them to include a copy of the virus
  - Replicates and infects other content
  - Easily spread through network environments
- When attacthed to an executable, virus can do anything the program does
- Specific to hardware and OS

### Infected Mechanism

- Means by which a virus spreads or propagates
- Infection vector

### Trigger

- Event of condition that determines when the payload is active or delivered
- Logic bomb

### Payload

- What the virus does
- May involve damange

### Phases

1. Dormant
2. Triggering
3. Propagation
4. Execution

### Classifications

#### Target

- Boot sector infector
- File infector
- Macro virus
- Multipartite virus

#### Concealement

- Encrypted Virus
- Stealth virus
- Polymorphic
- Metamorphic

## Worms

- Actively seek out more machines to infect
- Spreads to shared media
- Email worms spread in macro or script code
- Usually carries some form pf payload
- Xerox Palo Alto Labs

### Replication

- Email or IM
- File Sharing
- Remote execution
- Remote file access
- Remote login

### Target Discovery

#### Scanning or fingerprinting

- Probes random addresses in the IP space
- High volume of internet traffic

#### Hit list

- Attacker compiles a long list of potential vulnerable machines
- Infects machines on list
- Each infected machine is given a portion of list to scan
- Very short scanning period

#### Topological

- Information contained on an infected victim to find more hosts to scan

#### Local subnet

- Host looks for targets in its own network
- Uses subnet address to find other hosts

### Morris Worm

- Earliest Worm
- Spread on UNIX Systems
- Crack local password file to login to other systems
- Exploited a bug in the finger protocol
- Trapdoor in the debug option of the remote process that receives and sends mail

### Features

- Multiplatform
- Multiexploit
- Ultrafast spreading
- Polymorphic
- Metamorphic

### Mobile Worms

- Cabir Worm in 2004
- Communicate via Bluetooth wireless or MMS
- Disable phone, delete data, or force to send costly messages
- CommWarrior replicates by means of bluetooth, sends itself as an MMS file to contacts and an auto reply to incoming texts

## Payload System Corruption

### Chernobyl Virus

- First seen in 1998
- Windows 95 and 98 Virus
- Infects .exe and corrupts the entire file system when trigger date is reached
- Rewrites BIOS Code

### Klez

- Mass Mailing Worm infecting from Win 95 to XP
- On trigger date, causes file on hard drive to become empty

### Ransomware

- Encrypts data and demands payment for key to unlock
- Gpcode Trojan 2006

## Remote Control Facility

- Distinguishes a bot from a worm
- Bot is initially controlled by some central facility
- Typical means of implementing is on an IRC server
- Join a specific channel on this server and treat messages as commands
- Recently started using HTTP
- Peer to peer protocols

## Worm Countermeasures

- Considerable overlap between viruses and worms
- Once a worm is on a machine, antivirus can find and remove it

### Defenses

- Signature based worm scan filtering
- Filter based worm containment
- Payload classification
- Threshold random walk
- Rate halting
- Rate limiting

## Perimeter Scanning

- Antivirus typically included in email and Web Proxy
- May include intrusion prevention measures
- Approach is limited to scanning Malware

### Ingress

- Located at border between enterprise network and Internet
- Look for incoming traffic to unused local IP addresses

### Egress

- Located at the Egress point of individual LANs as well as border
- Monitors outgoing traffic for signs of scanning or other sus behaviour

## Summary

### Propagation

- Infected Content => Viruses
- Vulnerability Explout => Worms
- Social Engineering => Spam, email, Trojans
- Payload => System corruption, Attack Agent, Zombie, Bots
- Information Theft => Keyloggers, Phishing, Spyware, Stealthing

# Ransomware

- Model of monetization of a compromised organization's access that has become popular
- Have no need to look for data of specific value
- No need to find buyer's data
- Interrupt organization's critical function
- Example: WannaCry, NotPetya
- Top 3 Cyberthreat
- Double Extorsion => Pay to unencrypt your data, Pay for not leaking sensitive information
- Quantum Ransomware => 3 hours 44 minutes
- Bypasses most security layers

## Ransomware as a Service

- A SaaS for ransomware to lower skill requirements
- **_Operators_** provide infrastructure, uptime, malware dev
- **_Affiliates_** are responsible for spreading ransomware
- Operators also partner with Peddlers
- Profits are shared

## Attack Flow

1. Compromise and Persistence
2. Communicate with C&C
3. Recon
4. Credential Harvesting
5. Lateral Movement
6. Exfiltrate Data
7. Defense Evasion

- Above steps are common to APTs and some Malwares

1. Encrypt files
2. Delete backups
3. Drop ransomware notes
4. Extortion and Coercion
5. Money Laundering

- This is for Ransomware only

## Defense Evasion

1. Disable Security Software
2. Interrupt agent communication
3. Hide from security software
4. Louck out IR and Defenders

# Analysis

## Conficker Worm

- Most notorious
- Was supposed to cause a major internet breakdown in 2009
- Nothing happened
- Stuxent and Conficker had many similarities
- Stuxnet sabotaged the nuclear program of a country

### How did it spread

- Pre-patched version of Windows could be infected by remote execution needed by RPC coming from port 445
- Assigned to resource sharing smb protocl
- When machine receives a string on port 445:
  - Download a copy of the worm using the HTTP and previously infected machine and store as a DLL
  - Execute command to get new instance of svchost porcess to host the worm DLL
  - Appropriate entries in the registries
  - Randomly constructed name to worm file
  - Continue propagation
- Worm drops a copy of itself in the hard disks on other machines
- Comes with a copy of 240 commonly used passwords
- Worm created a new folder at the root of these other disks
- NetBIOS Share propagation mode
- Can also copy in autorun.inf on USB
- USB Propagation mode

## STUXNET Worm

- Attack a particular piece of industrial software known as SCADA => Supervisory Control and Data Acquisition
- Three Vulnerabilities in Windows
  - MS10-061 => Print spooler service
    - Spread in a network that share a printer
  - MS08-067 => Remote code execution
  - Propagate via removable disk drives by the MS10-046 vuln

## WannaCry

- Crippled hospitals and banks in UK, Canada etc
- FedEx, Hitachi, Nissan etc

### Two modes of propagation

- Exploits a vuln in Samba Protocol
- Doublepulsar back door if it is already prersent => Port 139 and 445
- Close the ports 139 and 445
- SMB is vuln to buffer overflow in a kernel function
- Hops from one host to another through random scans in which it searches for hosts with open 445 port
- Can also pull itself into a victim machine through the Doublepulsar backdoor

### DoublePulsar

- Created by NSA for penetrating foreign networks
- An implant is a polymorphic virus => Has one behaviour when first installed, then changes behaviour when machine is rebooted
- WannaCry first checks if DoublePulsar is already installed
  - If there, then it asks DoublePulsar to pull in the worm
  - Otherwise it pushes itself into machine via port 443 and makes backdoor
- DoublePulsar will still be installed even though WannaCry is removed
- DoublePulsar is only on the RAM
